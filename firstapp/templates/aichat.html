{% extends 'base.html' %}
{% load static %}

{% block title %}AI Chocolate Assistant - WinnieCho{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/aichat.css' %}">

{% endblock %}

{% block content %}
<section class="ai-chat-section">
    <!-- Background Pattern -->
    <div class="ai-pattern"></div>
    
    <div class="ai-chat-container">
        <!-- Sidebar -->
        <aside class="ai-sidebar">
            <div class="sidebar-header">
                <div class="ai-avatar">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M8.56 2.75c4.37 6.03 6.02 9.42 8.03 17.72m2.54-15.38c-3.72 4.35-8.94 5.66-16.88 5.85m19.5 1.9c-3.5-.93-6.63-.82-8.94 0-2.58.92-5.01 2.86-7.44 6.32"/>
                    </svg>
                </div>
                <h2>Choco AI</h2>
                <p>Your Chocolate Expert</p>
            </div>
            
            <div class="sidebar-content">
                <!-- Suggested Prompts -->
                <div class="prompts-section">
                    <h3>Try asking...</h3>
                    <div class="prompt-grid">
                        <button class="prompt-btn" data-prompt="What's the difference between dark, milk, and white chocolate?">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                            Chocolate Types
                        </button>
                        <button class="prompt-btn" data-prompt="Recommend a chocolate gift for Valentine's Day">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                            Gift Ideas
                        </button>
                        <button class="prompt-btn" data-prompt="How should I store chocolate to keep it fresh?">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            Storage Tips
                        </button>
                        <button class="prompt-btn" data-prompt="What are the health benefits of dark chocolate?">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Health Benefits
                        </button>
                    </div>
                </div>
                
                <!-- Chat History -->
                <div class="history-section">
                    <div class="history-header">
                        <h3>Recent Chats</h3>
                        <button class="clear-history" id="clearHistory">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Clear
                        </button>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="usage-info">
                    <div class="usage-bar">
                        <div class="usage-fill" id="usageFill"></div>
                    </div>
                    <span class="usage-text">API Usage</span>
                </div>
                <a href="{% url 'dashboard' %}" class="back-to-dashboard">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </aside>
        
        <!-- Main Chat Area -->
        <main class="ai-chat-main">
            <div class="chat-header">
                <div class="chat-title">
                    <h1>Chocolate AI Assistant</h1>
                    <p>Ask anything about chocolate, recipes, gifts, and more</p>
                </div>
                <div class="chat-info">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>Online</span>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages Container -->
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message-wrapper ai-message welcome-message">
                    <div class="message-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8.56 2.75c4.37 6.03 6.02 9.42 8.03 17.72m2.54-15.38c-3.72 4.35-8.94 5.66-16.88 5.85m19.5 1.9c-3.5-.93-6.63-.82-8.94 0-2.58.92-5.01 2.86-7.44 6.32"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="sender-name">Choco AI</span>
                            <span class="message-time">Just now</span>
                        </div>
                        <div class="message-text">
                            <h3>Hello! I'm your Chocolate AI Assistant üç´</h3>
                            <p>I can help you with:</p>
                            <ul>
                                <li>Chocolate recommendations and pairings</li>
                                <li>Recipe ideas and cooking tips</li>
                                <li>Gift suggestions for special occasions</li>
                                <li>Storage and freshness advice</li>
                                <li>Health benefits and nutritional info</li>
                                <li>Chocolate making techniques</li>
                            </ul>
                            <p>What would you like to know about chocolate today?</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input Area -->
            <div class="chat-input-area">
                <form id="chatForm" class="chat-form">
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            placeholder="Ask about chocolate, recipes, gifts..." 
                            rows="1"
                            maxlength="1000"
                        ></textarea>
                        <div class="input-actions">
                            <button type="submit" class="send-btn" id="sendBtn" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="input-footer">
                        <div class="char-count">
                            <span id="charCount">0</span>/1000
                        </div>
                        <div class="input-hint">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            Press <kbd>Enter</kbd> to send, <kbd>Shift + Enter</kbd> for new line
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>
</section>

<!-- Typing Indicator Template -->
<template id="typingIndicator">
    <div class="message-wrapper ai-message typing-message">
        <div class="message-avatar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"/>
                <path d="M8.56 2.75c4.37 6.03 6.02 9.42 8.03 17.72m2.54-15.38c-3.72 4.35-8.94 5.66-16.88 5.85m19.5 1.9c-3.5-.93-6.63-.82-8.94 0-2.58.92-5.01 2.86-7.44 6.32"/>
            </svg>
        </div>
        <div class="message-content">
            <div class="message-header">
                <span class="sender-name">Choco AI</span>
            </div>
            <div class="typing-indicator">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            </div>
        </div>
    </div>
</template>

<script src="{% static 'js/aichat.js' %}"></script>
<script>
// Set Django CSRF token for API calls
const CSRF_TOKEN = "{{ csrf_token }}";
</script>
{% endblock %}