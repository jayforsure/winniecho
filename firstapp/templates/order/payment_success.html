{% extends 'base.html' %}
{% load static %}

{% block title %}Payment Success - WinnieCho{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/order/payment_success.css' %}">
{% endblock %}

{% block content %}
<div class="success-wrapper">
    <div class="success-container">
        <!-- Success Animation -->
        <div class="success-animation">
            <div class="checkmark-circle">
                <svg class="checkmark" width="80" height="80" viewBox="0 0 52 52">
                    <circle class="checkmark-circle-path" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>
        </div>

        <!-- Success Message -->
        <div class="success-message">
            <h1>Payment Successful!</h1>
            <p>Thank you for your purchase. Your order has been confirmed.</p>
        </div>

        <!-- Order Summary Card -->
        <div class="summary-card">
            <div class="summary-row">
                <span class="label">Order Number</span>
                <span class="value">#{{ order.order_number }}</span>
            </div>
            <div class="summary-row">
                <span class="label">Total Paid</span>
                <span class="value highlight">RM {{ payment.total_amount|floatformat:2 }}</span>
            </div>
            <div class="summary-row">
                <span class="label">Payment Method</span>
                <span class="value">{{ payment.get_method_display }}</span>
            </div>
            <div class="summary-row">
                <span class="label">Date</span>
                <span class="value">{{ order.created_at|date:"M d, Y H:i" }}</span>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="{% url 'order_detail' order.id %}" class="btn-action btn-primary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
                View Receipt
            </a>
            <a href="{% url 'products' %}" class="btn-action btn-secondary">Continue Shopping</a>
            <a href="{% url 'dashboard' %}" class="btn-action btn-secondary">My Account</a>
        </div>

        <!-- Additional Info -->
        <div class="info-box">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <div class="info-text">
                <p><strong>What's Next?</strong></p>
                <p>A confirmation email has been sent to {{ order.address.user.email }}. Your order will be processed and shipped soon.</p>
            </div>
        </div>
    </div>
</div>

<!-- CRITICAL FIX: Clear localStorage cart -->
<script>
(function() {
    console.log('‚úÖ Payment successful - clearing localStorage cart');
    
    // Clear localStorage cart immediately
    localStorage.removeItem('chocolateCart');
    
    // Set flag so products page knows cart was cleared
    sessionStorage.setItem('payment_completed', 'true');
    sessionStorage.setItem('cart_cleared_at', new Date().toISOString());
    
    console.log('üßπ Cart cleared from localStorage');
    console.log('üèÅ Flag set: payment_completed = true');
})();
</script>
{% endblock %}